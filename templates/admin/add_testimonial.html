{% extends "admin/admin_base.html" %}
{% block title %}Add New Testimonial{% endblock %}

{% block content %}

<!-- =========================
   PAGE HEADER
========================= -->
<div class="testimonial-page-header">
    <div class="header-top">
        <a href="/admin/testimonials" class="back-link">‚Üê</a>
        <div class="header-content">
            <h1>Add New Testimonial</h1>
            <p>Add a client testimonial or review</p>
        </div>
    </div>
</div>

<!-- =========================
   CLIENT INFORMATION
========================= -->
<div class="testimonial-card">
    <h3 class="card-title">Client Information</h3>
    <div class="card-divider"></div>

    <div class="form-grid-two">

        <div class="form-group">
            <label>
                <span class="label-icon">üë§</span>
                Client Name <span class="required">*</span>
            </label>
            <input
                type="text"
                id="name"
                placeholder="e.g., John Doe"
                required
            >
        </div>

        <div class="form-group">
            <label>
                <span class="label-icon">üìç</span>
                Client Location <span class="required">*</span>
            </label>
            <input
                type="text"
                id="location"
                placeholder="e.g., Nairobi"
                required
            >
        </div>

    </div>

    <div class="form-group full-width">
        <label>
            Property Purchased <span class="required">*</span>
        </label>
        <input
            type="text"
            id="property"
            placeholder="e.g., Prime Agricultural Land - Naivasha"
            required
        >
    </div>
</div>

<!-- =========================
   TESTIMONIAL DETAILS
========================= -->
<div class="testimonial-card">
    <h3 class="card-title">Testimonial Content</h3>
    <div class="card-divider"></div>

    <!-- RATING -->
    <div class="form-group">
        <label>
            Rating <span class="required">*</span>
        </label>

        <select id="rating" required onchange="updateStarPreview()">
            <option value="5">5 Stars - Excellent</option>
            <option value="4">4 Stars - Very Good</option>
            <option value="3">3 Stars - Good</option>
            <option value="2">2 Stars - Fair</option>
            <option value="1">1 Star - Poor</option>
        </select>

        <div class="rating-preview">
            <span class="preview-label">Preview:</span>
            <span class="stars" id="starPreview">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
        </div>
    </div>

    <!-- MESSAGE -->
    <div class="form-group">
        <label>
            Testimonial Text <span class="required">*</span>
        </label>

        <textarea
            id="message"
            rows="6"
            placeholder="Write the client's testimonial or review here..."
            oninput="updateCharCount()"
            required
        ></textarea>

        <div class="char-count">
            <span id="charCount">0</span> characters
        </div>
    </div>
</div>

<!-- =========================
   PUBLICATION SETTINGS
========================= -->
<div class="testimonial-card">
    <h3 class="card-title">Publication Settings</h3>
    <div class="card-divider"></div>

    <div class="form-grid-two">

        <div class="form-group">
            <label>
                Status <span class="required">*</span>
            </label>
            <select id="status" required>
                <option value="draft">Pending Review</option>
                <option value="published">Published</option>
            </select>
            <small class="helper-text">
                Pending testimonials won't be visible on the website
            </small>
        </div>

        <div class="form-group">
            <label>
                Featured Testimonial
            </label>
            <select id="featured">
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
            <small class="helper-text">
                Featured testimonials appear on the homepage
            </small>
        </div>

    </div>
</div>

<!-- =========================
   ACTIONS
========================= -->
<div class="testimonial-actions">
    <button class="btn-secondary" onclick="history.back()">Cancel</button>
    <button class="btn-primary" onclick="saveTestimonial()">
        Add Testimonial
    </button>
</div>

{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/testimonials.css') }}">
{% endblock %}

{% block scripts %}
<script>
function updateCharCount() {
    const textarea = document.getElementById('message');
    const count = textarea.value.length;
    document.getElementById('charCount').textContent = count;
}

function updateStarPreview() {
    const rating = document.getElementById('rating').value;
    const starPreview = document.getElementById('starPreview');
    const stars = '‚òÖ'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
    starPreview.textContent = stars;
}

function saveTestimonial() {
    const name = document.getElementById('name').value;
    const location = document.getElementById('location').value;
    const property = document.getElementById('property').value;
    const rating = document.getElementById('rating').value;
    const message = document.getElementById('message').value;
    const status = document.getElementById('status').value;
    const featured = document.getElementById('featured').value;

    if (!name || !location || !property || !rating || !message) {
        alert('Please fill in all required fields');
        return;
    }

    const data = {
        name,
        location,
        property,
        rating: parseInt(rating),
        message,
        status,
        featured: featured === 'true'
    };

    fetch('/admin/testimonials/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Testimonial added successfully!');
            window.location.href = '/admin/testimonials';
        } else {
            alert('Error: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while saving the testimonial');
    });
}
</script>
{% endblock %}
