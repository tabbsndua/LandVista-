{% extends "admin/admin_base.html" %}

{% block title %}Dashboard | Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin-dashboard-modern.css') }}">
{% endblock %}

{% block topbar %}
<div class="admin-title-block">
    <p class="admin-kicker">Realtime Control Center</p>
    <h1>LandVista Command Dashboard</h1>
    <p class="dashboard-live-indicator" id="liveStatus">Live sync active</p>
</div>
{% endblock %}

{% block content %}
<section class="dashboard-modern-wrap">
    <div class="dashboard-hero-panel" data-reveal>
        <div>
            <h2>Operational Snapshot</h2>
            <p>Track listings, leads, sales momentum, and publishing workflow from one responsive dashboard.</p>
        </div>
        <div class="hero-actions">
            <a href="/admin/properties" class="hero-btn">Manage Listings</a>
            <a href="/admin/inquiries" class="hero-btn ghost">Review Leads</a>
        </div>
    </div>

    <section class="dashboard-kpi-grid" data-reveal>
        <article class="kpi-card" data-kpi="properties">
            <p>Total Properties</p>
            <h3 id="total-properties">{{ total_properties|default(0) }}</h3>
            <span>Inventory across all statuses</span>
        </article>
        <article class="kpi-card" data-kpi="clients">
            <p>Active Clients</p>
            <h3 id="active-clients">{{ active_clients|default(0) }}</h3>
            <span>Registered client records</span>
        </article>
        <article class="kpi-card" data-kpi="testimonials">
            <p>Testimonials</p>
            <h3 id="total-testimonials">{{ total_testimonials|default(0) }}</h3>
            <span>Published social proof assets</span>
        </article>
        <article class="kpi-card" data-kpi="sales">
            <p>Total Sales</p>
            <h3>KSh <span id="total-sales">{{ total_sales|default(0) }}</span></h3>
            <span>Aggregated transaction value</span>
        </article>
        <article class="kpi-card" data-kpi="views">
            <p>Page Views</p>
            <h3 id="page-views">{{ page_views|default(0) }}</h3>
            <span>Visitor traffic tracked</span>
        </article>
        <article class="kpi-card" data-kpi="sold">
            <p>Properties Sold</p>
            <h3 id="properties-sold">{{ properties_sold|default(0) }}</h3>
            <span>Closed inventory this cycle</span>
        </article>
    </section>

    <section class="dashboard-insights-grid" data-reveal>
        <article class="insight-panel">
            <div class="panel-head">
                <h3>Performance Signals</h3>
            </div>
            <div class="signal-item">
                <div>
                    <p>Conversion Ratio</p>
                    <strong id="conversion-rate">0%</strong>
                </div>
                <div class="signal-bar"><span id="conversion-rate-bar" style="width:0%"></span></div>
            </div>
            <div class="signal-item">
                <div>
                    <p>Client Engagement</p>
                    <strong id="engagement-score">0%</strong>
                </div>
                <div class="signal-bar"><span id="engagement-score-bar" style="width:0%"></span></div>
            </div>
            <div class="signal-item">
                <div>
                    <p>Content Freshness</p>
                    <strong id="content-health">0%</strong>
                </div>
                <div class="signal-bar"><span id="content-health-bar" style="width:0%"></span></div>
            </div>
        </article>

        <article class="insight-panel">
            <div class="panel-head">
                <h3>Quick Actions</h3>
            </div>
            <div class="quick-action-grid">
                <a href="/admin/properties" class="quick-action-item">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add or Edit Property</span>
                </a>
                <a href="/admin/payments" class="quick-action-item">
                    <i class="fas fa-credit-card"></i>
                    <span>Generate Payment Link</span>
                </a>
                <a href="/admin/site-visits" class="quick-action-item">
                    <i class="fas fa-calendar-plus"></i>
                    <span>Schedule Site Visit</span>
                </a>
                <a href="/admin/news" class="quick-action-item">
                    <i class="fas fa-pen-nib"></i>
                    <span>Publish News Update</span>
                </a>
            </div>
        </article>
    </section>

    <section class="dashboard-content-grid" data-reveal>
        <article class="stream-panel">
            <div class="panel-head">
                <h3>Recent Inquiries</h3>
                <a href="/admin/inquiries">Open all</a>
            </div>
            <div class="stream-list" id="recent-inquiries-list">
                {% if recent_inquiries %}
                    {% for i in recent_inquiries %}
                    <div class="stream-row">
                        <div>
                            <strong>{{ i.name or 'Lead' }}</strong>
                            <p>{{ i.email or 'No email' }}</p>
                            <small>{{ i.property_title or i.property or 'General inquiry' }}</small>
                        </div>
                        <span class="tag">{{ i.status or 'new' }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="empty-text">No inquiries yet.</p>
                {% endif %}
            </div>
        </article>

        <article class="stream-panel">
            <div class="panel-head">
                <h3>Recent Properties</h3>
                <a href="/admin/properties">Open all</a>
            </div>
            <div class="stream-list" id="recent-properties-list">
                {% if recent_properties %}
                    {% for p in recent_properties %}
                    <div class="stream-row">
                        <div>
                            <strong>{{ p.title or 'Untitled property' }}</strong>
                            <p>{{ p.location or 'Kenya' }}</p>
                            <small>KSh {{ '{:,}'.format(p.price|int) if p.price else '0' }}</small>
                        </div>
                        <span class="tag {{ 'sold' if (p.status or '')|lower == 'sold' else '' }}">{{ p.status or 'available' }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="empty-text">No properties added yet.</p>
                {% endif %}
            </div>
        </article>
    </section>

    <section class="dashboard-content-grid" data-reveal>
        <article class="stream-panel">
            <div class="panel-head">
                <h3>Latest News</h3>
                <a href="/admin/news">Manage</a>
            </div>
            <div class="stream-list" id="latest-news-list">
                {% if latest_news %}
                    {% for article in latest_news %}
                    <div class="stream-row compact">
                        <div>
                            <strong>{{ article.title or 'Untitled article' }}</strong>
                            <small>{{ article.author or 'Team' }} | {{ article.category or 'General' }}</small>
                        </div>
                        <span class="tag">{{ article.status or 'published' }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="empty-text">No published news yet.</p>
                {% endif %}
            </div>
        </article>

        <article class="stream-panel">
            <div class="panel-head">
                <h3>Latest Legal Guides</h3>
                <a href="/admin/legal-guides">Manage</a>
            </div>
            <div class="stream-list" id="latest-guides-list">
                {% if latest_guides %}
                    {% for guide in latest_guides %}
                    <div class="stream-row compact">
                        <div>
                            <strong>{{ guide.title or 'Untitled guide' }}</strong>
                            <small>{{ guide.author or 'Team' }} | {{ guide.category or 'Legal' }}</small>
                        </div>
                        <span class="tag">{{ guide.status or 'published' }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="empty-text">No legal guides yet.</p>
                {% endif %}
            </div>
        </article>
    </section>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script defer src="{{ url_for('static', filename='js/admin-dashboard-modern.js') }}"></script>
{% endblock %}
